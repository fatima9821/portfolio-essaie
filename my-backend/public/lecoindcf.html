<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Partagez vos recettes</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/line-awesome/1.3.0/line-awesome/css/line-awesome.min.css">
</head>
<body>
    <header>
        <nav>
          <ul>
            <li><a href="index.html">Accueil</a></li>
            <li><a href="nosplats.html">Nos Plats</a></li>
            <li><a href="recettespartager.html">Partager une Recette</a></li>
            <li><a href="contact.html">Contact</a></li>
          </ul>
          <div class="nav-search">
            <div class="nav-search__el">
                <i class="las la-search"></i>
                <input type="text" placeholder="Recherche" class="search-ip"/>
            </div>
        </div>
          <div class="login-container">
            <div class="login-icon">
              <i class="las la-user-circle"></i>
            </div>
            
          </div>
        </nav>
      </header>
    
      <section class="hero">
        <h1>Partagez vos Recettes</h1>
        <p>Découvrez les créations des autres utilisateurs et partagez vos plats préférés !</p>
      </section>
    
      <section id="submit-section" class="form-section">
        <h2>Soumettez votre recette</h2>
        <form id="recipe-form" enctype="multipart/form-data">
          <label for="recipe-name">Nom de la recette :</label>
          <input type="text" id="recipe-name" name="title" required>
    
          <label for="ingredients">Ingrédients :</label>
          <textarea id="ingredients" name="ingredients" rows="5" required></textarea>
    
          <label for="instructions">Instructions :</label>
          <textarea id="instructions" name="instructions" rows="8" required></textarea>
    
          <label for="image">Image de la recette :</label>
          <input type="file" id="image" name="image" accept="image/*">
    
          <button type="submit">Partager ma recette</button>
        </form>
      </section>

      <section class="recipes">
        <h2>Recettes récemment partagées</h2>
        <div id="recipe-list">
          <!-- Les recettes partagées s'afficheront ici -->
        </div>
      </section>
      <script src="script.js"></script>
      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const form = document.getElementById('recipe-form');

          // Vérifier si le formulaire existe
          if (form) {
            form.addEventListener('submit', async (event) => {
              event.preventDefault(); // Empêche le rechargement de la page

              const formData = new FormData(form);  // Collecte des données du formulaire

              // Vérification du token avant de soumettre
              const token = localStorage.getItem('token');
              if (!token) {
                alert('Vous devez être connecté pour soumettre une recette.');
                return;
              }

              try {
                // Envoi de la requête POST à l'API pour publier la recette
                const response = await fetch('http://localhost:4011/recipes', {
                  method: 'POST',
                  headers: {
                    'Authorization': 'Bearer ' + token  // JWT token
                  },
                  body: formData
                });
                if (response.ok) {
                  alert('Recette publiée avec succès!');
                  window.location.href = 'recettespartager.html'; // Redirection après succès
                } else {
                  const errorMsg = await response.text(); // Lire le message d'erreur du serveur
                  alert('Erreur lors de la publication de la recette : ' + errorMsg);
                }
              } catch (error) {
                console.error('Erreur lors de la soumission :', error);
                alert('Erreur lors de la soumission du formulaire.');
              }
            });
          } else {
            console.error("Le formulaire de recette n'a pas été trouvé.");
          }
        });
      </script>
</body>
</html>